<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>beforeRunningCommand</key>
	<string>nop</string>
	<key>command</key>
	<string>#!/usr/bin/env ruby

require ENV['TM_BUNDLE_SUPPORT'] + '/lib/flex_env'

FlexMate.opt_in_to_completions

p = PropertyInspector.capture
TextMate.exit_show_tool_tip("No property found.") if p[:ref] == nil

c = ClassParser.new

if p[:is_static]
	c.load_statics(STDIN.read.strip,p[:ref])
else
	c.load(STDIN.read.strip,p[:ref])
end

FlexMate::Log.puts(c.log)

a = CompletionsList.new(c)

m = a.list_d2
if m.size &gt; 0
	FlexMate.complete(m,p[:filter],c.exit_message)
	exit
end

if c.exit_message
	FlexMate.tooltip( c.exit_message )
	exit
end

FlexMate.tooltip "No completions."

# OLD AUTO COMPLETE WITH SUPPORT FOR DIALOG1
# #FlexMate.write_to_log_file(c.log)
# 
# a = CompletionsList.new(c)
# 
# if FlexMate.has_dialog2
#   m = a.list_d2
#   if m.size &gt; 0
#     FlexMate.complete(m,p[:filter],c.exit_message)
#     exit
#   end
#   FlexMate.tooltip c.exit_message
#   exit
# else
#   m = a.list
# end
# 
# m = m.select {|item| item['title'] =~ /^#{p[:filter]}/ } unless p[:filter] == nil
# 
# TextMate.exit_show_tool_tip("Auto-completions unvailable") if m.empty?
# 
# r = TextMate::UI.menu(m)
# 
# FlexMate.tooltip(c.exit_message)
# 
# if r != nil
# 
#   out = r['data']
#   out.sub!( p[:filter], '') if p[:filter]
#   out = FlexMate.snippetize_method_params(out)
#   out += ";" if r['typeof'] == "void"
# 
#   TextMate.exit_insert_snippet(out)
# 
# else
#   
#   out = ";" if c.return_type_void
# 
#   TextMate.exit_insert_text(out)
#   
# end
</string>
	<key>input</key>
	<string>document</string>
	<key>keyEquivalent</key>
	<string>~</string>
	<key>name</key>
	<string>Auto Complete</string>
	<key>output</key>
	<string>afterSelectedText</string>
	<key>scope</key>
	<string>source.actionscript.3 meta.package.actionscript.3 meta.class.actionscript.3, source.actionscript.3 meta.package.actionscript.3 meta.class.actionscript.3 meta.scope.following.dot.actionscript.3</string>
	<key>uuid</key>
	<string>54A320D0-2134-4DE0-9A6B-F341D39A7C0C</string>
</dict>
</plist>
